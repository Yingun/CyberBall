import{P as N}from"./PlayerImg-74a877ea.js";import{_,r as d,o as u,c as y,a as f,n as x,b as w,d as o,t as m,e as D,F as P,f as b,N as S,g as W}from"./index-0a647db9.js";const R={name:"Player",components:{PlayerImg:N},props:{isLeftWard:Boolean,playerStyle:String,playerName:String},emits:["moveBall","playerLoaded"]};function T(t,e,r,l,s,a){const n=d("PlayerImg");return u(),y("div",null,[f(n,{class:x(r.isLeftWard?"player-leftWard":"player-rightWard"),style:w(r.playerStyle),onClick:e[0]||(e[0]=c=>t.$emit("moveBall")),onLoad:e[1]||(e[1]=c=>t.$emit("playerLoaded"))},null,8,["class","style"]),o("p",null,m(r.playerName),1)])}const M=_(R,[["render",T]]);const k={name:"Ball",props:{posx:Number,posy:Number,moveDur:Number},computed:{ballStyle(){return`transform:translate(${this.posx}vw, ${this.posy}rem); transition: ${this.moveDur}s ease-out`}}};function z(t,e,r,l,s,a){return u(),y("img",{class:"ball",src:D,style:w(a.ballStyle)},null,4)}const A=_(k,[["render",z]]);const I={props:{throwNum:Number,score:Array}},O={class:"score-board"},G={class:"score-row"};function X(t,e,r,l,s,a){return u(),y("div",O,[o("p",null,"目前球数："+m(r.throwNum),1),e[0]||(e[0]=o("p",null,"排行榜：",-1)),o("ol",null,[(u(),y(P,null,b(3,n=>o("li",{key:n},[o("div",G,[o("div",null,m(r.score[n-1].player),1),o("div",null,m(r.score[n-1].value),1)])])),64))])])}const Y=_(I,[["render",X]]),E={rect:{mode1:["3 / 2 / auto / 4","2 / 1","2 / 4","1 / 2 / auto / 4","3 / 3","1 / 3","1 / 1 / 3","1 / 4 / 3","3 / 1 / auto / 3"],mode2:["3 / 2","2 / 1 / 4","2 / 4 / 4","1 / 2","3 / 3 / auto / 5","1 / 4 / 3","1 / 1 / 3","1 / 4 / 3","3 / 1 / auto / 3"]},modeMap:{3:[],4:[],5:[0],6:[0,3],7:[0,1,2,5],8:[0,1,2,3],9:[1,2,3,4]}},V=t=>{const e=t.map(r=>r*Math.random());return e.indexOf(Math.max(...e))},F=t=>{const e=[...t],r=[...t];e.sort((n,c)=>c-n);const l=r.indexOf(e[0]);r[l]=void 0;const s=r.indexOf(e[1]);r[s]=void 0;const a=r.indexOf(e[2]);return r[a]=void 0,[l,s,a]},H=t=>new Promise(e=>{setTimeout(e,t)}),p={playerLayout:E,getRandomIdx:V,getTopIdx:F,sleep:H};const B=16,v=67,U=5,j=2e3,h={playerPos:{}},q={components:{ScoreBoard:Y,NavButton:S,Player:M,Ball:A},data(){return{score:{throwCounts:0,playerCounts:[0,0,0,0,0,0,0,0,0]},player:{num:4,numInput:4,turnDur:0,filter:"sepia(1) saturate(20)",hue:180,gray:0,name:["player","player1","player2","player3","player4","player5","player6","player7","player8"],isLeftWard:[!1,!1,!0,!1,!0,!0,!1,!0,!1,!0],refs:[]},ball:{pos:[-10,-10],moveDur:0,owner:void 0}}},computed:{scoreRank(){const[t,e,r]=p.getTopIdx(this.score.playerCounts);return[{player:this.player.name[t],value:this.score.playerCounts[t]},{player:this.player.name[e],value:this.score.playerCounts[e]},{player:this.player.name[r],value:this.score.playerCounts[r]}]},playerStyle(){const t=(r,l,s)=>`filter: ${this.player.filter} hue-rotate(${r}deg) grayscale(${l}%); transition:${s}s linear`,e=[t(this.player.hue,this.player.gray,this.player.turnDur)];for(let r=1;r<this.player.num;r++)e.push(t(Math.random()*360,Math.random()*100,0));return e},gridArea(){const t=r=>p.playerLayout.modeMap[this.player.num].includes(r)?`grid-area: ${p.playerLayout.rect.mode2[r]}`:`grid-area: ${p.playerLayout.rect.mode1[r]}`,e=[];for(let r=0;r<this.player.num;r++)e.push(t(r));return e}},methods:{loadConfigs(){this.player.name[0]=this.$store.getters.playerName||this.player.name[0],this.player.hue=this.$store.getters.playerHue||this.player.hue,this.player.gray=this.$store.getters.playerGray||this.player.gray,this.player.num=this.$store.getters.playerNum||this.player.num},scoreCounter(t){this.score.throwCounts++,this.score.playerCounts[t]++},watchWindowResize(){window.addEventListener("resize",()=>{h.playerPos={},this.updateBallPosOnResize()},!1)},onPlayerTurn(t){const e=t.clientX;for(const r of[0]){const l=this.setPlayerDirection(e,r);if(l===-1)break;if(this.ball.owner==r){const s=l?-v:v;this.shiftBallPos(s,this.player.turnDur)}}},setPlayerRef(t){t&&this.player.refs.push(t.$el.childNodes[0])},setPlayerDirection(t,e){var l;if(!((l=this.player.refs[e])!=null&&l.offsetLeft))return-1;const r=t<this.player.refs[e].offsetLeft;return r==this.player.isLeftWard[e]?-1:(this.player.isLeftWard[e]=r,r)},getPlayerPos(t){var s,a;if(h.playerPos[t])return h.playerPos[t];const e=this.player.refs[t];if(!e)return console.log("reference error!"),[void 0,void 0];let r=(s=e.getClientRects()[0])==null?void 0:s.left,l=(a=e.getClientRects()[0])==null?void 0:a.top;return r!==void 0&&l!==void 0&&(h.playerPos[t]=[r,l]),[r,l]},getReceptorId(t){const e=(r=>{const l=[];for(let s=0;s<r;s++){l.push([]);for(let a=0;a<r;a++)s==a?l[s].push(0):l[s].push(1/(r-1))}return l})(this.player.num);return p.getRandomIdx(e[t])},getBallDx(t){let e=v;return this.player.isLeftWard[t]&&(e=0),e},onThrowBall(t){this.ball.owner==0&&this.throwBall(t)},async aiThrowBall(){const t=this.getReceptorId(this.ball.owner);await p.sleep(j),this.throwBall(t)},throwBall(t=0,e=.5){if(this.ball.moveDur=e,t==this.ball.owner)return"don't need to move the ball";this.setBallPos(t),this.ball.owner=t,this.scoreCounter(t),this.ball.owner>0&&this.aiThrowBall()},setBallPos(t){const e=this.getBallDx(t),[r,l]=this.getPlayerPos(t);if(!r||!l)return;const s=(r+e)/(window.innerWidth/100),a=(l-U)/B;this.ball.pos=[s,a]},resetBallPos(){this.ball.pos=[50-32/2/(window.innerWidth/100),(window.innerHeight-32)/B/2]},updateBallPosOnResize(){this.ball.moveDur=0,this.ball.owner||this.resetBallPos(),this.setBallPos(this.ball.owner)},shiftBallPos(t,e){this.ball.moveDur=e,this.ball.pos[0]+=t/(window.innerWidth/100)}},mounted(){this.loadConfigs(),this.watchWindowResize()},beforeUpdate(){this.player.refs=[]}},J={class:"game-page"},K={class:"main-page"},Q={id:"menu-btn"};function Z(t,e,r,l,s,a){const n=d("Player"),c=d("Ball"),L=d("ScoreBoard"),$=d("NavButton");return u(),y("div",J,[e[1]||(e[1]=o("h1",null,"CyberBall",-1)),o("div",K,[o("div",{class:"players-wrap",onMousemove:e[0]||(e[0]=(...g)=>a.onPlayerTurn&&a.onPlayerTurn(...g))},[(u(!0),y(P,null,b(a.gridArea,(g,i)=>(u(),W(n,{key:i,ref_for:!0,ref:a.setPlayerRef,style:w(g),playerStyle:a.playerStyle[i],playerName:s.player.name[i],isLeftWard:s.player.isLeftWard[i],title:`分数：${s.score.playerCounts[i]}`,onMoveBall:C=>a.onThrowBall(i),onPlayerLoaded:C=>i===0?a.throwBall(0,0):null},null,8,["style","playerStyle","playerName","isLeftWard","title","onMoveBall","onPlayerLoaded"]))),128))],32)]),f(c,{posx:s.ball.pos[0],posy:s.ball.pos[1],moveDur:s.ball.moveDur},null,8,["posx","posy","moveDur"]),f(L,{throwNum:s.score.throwCounts,score:a.scoreRank},null,8,["throwNum","score"]),o("div",Q,[f($,{destination:"/",text:"返回"})])])}const re=_(q,[["render",Z]]);export{re as default};
